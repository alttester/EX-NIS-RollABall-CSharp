name: Build RollABall

on: [push, workflow_dispatch]
concurrency:
  group: build-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  build-macOS:
    runs-on: [self-hosted, macOS]
    steps:
      - uses: actions/checkout@v3

      - name: Build RollABall
        run: |
          export ALTSERVER_PORT=13005
          export ALTSERVER_HOST="192.168.11.35"
          $UNITY_2021_3_HOME -batchmode -stackTraceLogType None -projectPath $CI_PROJECT_DIR -executeMethod BuildRollABall.MacBuildFromCommandLine -logFile buildMac.log -quit

      - uses: actions/upload-artifact@v4
        if: always() # run this step even if one of the previous step failed
        with:
          name: BuildMacArtifact
          path: |
            RollABall.app
            **/*.log